# å¤§æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æœåŠ¡å™¨

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.8.3-blue.svg)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-Latest-green.svg)](https://nodejs.org/)
[![Express](https://img.shields.io/badge/Express-5.1.0-lightgrey.svg)](https://expressjs.com/)

åŸºäº TypeScript å’Œ Node.js æ„å»ºçš„é«˜æ€§èƒ½æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æœåŠ¡å™¨ï¼Œæ”¯æŒå¤§æ–‡ä»¶çš„æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- ğŸ“¤ **å¤§æ–‡ä»¶ä¸Šä¼ ** - æ”¯æŒåˆ†å—ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼ 
- ğŸ“¥ **å¤§æ–‡ä»¶ä¸‹è½½** - æ”¯æŒèŒƒå›´è¯·æ±‚å’Œæ–­ç‚¹ç»­ä¼ 
- ğŸ” **ä¸Šä¼ çŠ¶æ€æŸ¥è¯¢** - å®æ—¶è·Ÿè¸ªä¸Šä¼ è¿›åº¦
- ğŸ” **MD5 æ ¡éªŒ** - è‡ªåŠ¨æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
- ğŸš€ **é«˜æ€§èƒ½** - é’ˆå¯¹å¤§æ–‡ä»¶å¤„ç†è¿›è¡Œä¼˜åŒ–
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†** - å…¨é¢çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- ğŸ“Š **æ—¥å¿—è®°å½•** - è¯¦ç»†çš„è¯·æ±‚å’Œæ“ä½œæ—¥å¿—

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
src/
â”œâ”€â”€ controllers/          # è¯·æ±‚å¤„ç†å™¨
â”‚   â””â”€â”€ fileController.ts # æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½/çŠ¶æ€æ§åˆ¶å™¨
â”œâ”€â”€ routes/              # API è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ fileUpload.ts    # ä¸Šä¼ ç«¯ç‚¹
â”‚   â”œâ”€â”€ fileDownload.ts  # ä¸‹è½½ç«¯ç‚¹
â”‚   â””â”€â”€ fileInfo.ts      # çŠ¶æ€æŸ¥è¯¢ç«¯ç‚¹
â”œâ”€â”€ types/               # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts         # æ¥å£å’Œæšä¸¾
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ fileUtils.ts     # æ–‡ä»¶æ“ä½œå’Œè¾…åŠ©å‡½æ•°
â””â”€â”€ index.ts             # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js
- **å¼€å‘è¯­è¨€**: TypeScript
- **Web æ¡†æ¶**: Express.js
- **æ–‡ä»¶å¤„ç†**: Multer, fs-extra
- **å®‰å…¨æ€§**: CORS æ”¯æŒ
- **æ—¥å¿—**: Morgan
- **å“ˆå¸Œ**: MD5-file

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚

- Node.js (v16 æˆ–æ›´é«˜ç‰ˆæœ¬)
- pnpm (æ¨è) æˆ– npm

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**
   ```bash
   git clone <repository-url>
   cd fileUploadServer
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   pnpm install
   ```

3. **æ„å»ºé¡¹ç›®**
   ```bash
   pnpm run build
   ```

## ğŸš€ è¿è¡Œæ–¹å¼

### å¼€å‘æ¨¡å¼

```bash
pnpm run dev
```

### ç”Ÿäº§æ¨¡å¼

```bash
pnpm start
```

æœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ `http://localhost:7777`ã€‚

## ğŸ“š API æ¥å£æ–‡æ¡£

### 1. æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰

**æ¥å£åœ°å€**: `POST /BigFileUploader`

**è¯·æ±‚ç±»å‹**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `file` | File | âœ… | æ–‡ä»¶äºŒè¿›åˆ¶æ•°æ®ï¼ˆåˆ†å—ï¼‰ |
| `name` | string | âœ… | åŸå§‹æ–‡ä»¶å |
| `chunks` | number | âœ… | æ€»åˆ†å—æ•° |
| `chunk` | number | âœ… | å½“å‰åˆ†å—ç¼–å·ï¼ˆä»1å¼€å§‹ï¼‰ |
| `totalLength` | number | âœ… | æ–‡ä»¶æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| `totalFileMd5` | string | âœ… | å®Œæ•´æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼ |
| `user_uid` | string | âœ… | ç”¨æˆ·æ ‡è¯†ç¬¦ |
| `file_type` | number | âŒ | æ–‡ä»¶ç±»å‹ï¼ˆ0: æ™®é€šæ–‡ä»¶, 1: è§†é¢‘æ–‡ä»¶ï¼‰ |

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "åˆ†å— 1/10 ä¸Šä¼ æˆåŠŸ",
  "data": {
    "filePath": "/path/to/merged/file" // ä»…åœ¨ä¸Šä¼ å®Œæˆæ—¶è¿”å›
  }
}
```

### 2. æ–‡ä»¶ä¸‹è½½æ¥å£ï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰

**æ¥å£åœ°å€**: `GET /BigFileDownloader`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `file_md5` | string | âœ… | æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼ |
| `user_uid` | string | âœ… | ç”¨æˆ·æ ‡è¯†ç¬¦ |
| `skip_length` | number | âŒ | è·³è¿‡çš„å­—èŠ‚æ•°ï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼‰ |

**å“åº”**: äºŒè¿›åˆ¶æ–‡ä»¶æµï¼ŒåŒ…å«é€‚å½“çš„æ–­ç‚¹ç»­ä¼ å“åº”å¤´ã€‚

**å“åº”å¤´**:
- `Content-Type`: `application/octet-stream`
- `Content-Disposition`: `attachment; filename="filename"`
- `Content-Length`: æ–‡ä»¶å¤§å°
- `Accept-Ranges`: `bytes`ï¼ˆæ”¯æŒèŒƒå›´è¯·æ±‚ï¼‰
- `Content-Range`: `bytes start-end/total`ï¼ˆéƒ¨åˆ†å†…å®¹ï¼‰

### 3. ä¸Šä¼ çŠ¶æ€æŸ¥è¯¢æ¥å£

**æ¥å£åœ°å€**: `POST /api/file/status`

**è¯·æ±‚ä½“**:

```json
{
  "processorId": "PROCESSOR_FILE",
  "jobDispatchId": "LOGIC_FILE_MGR",
  "actionId": "ACTION_APPEND1",
  "newData": {
    "file_md5": "abc123...",
    "user_uid": "user123",
    "file_type": 0
  }
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "returnValue": {
    "retCode": "2",
    "chunkCount": 5
  }
}
```

**çŠ¶æ€ç è¯´æ˜**:
- `0`: æ–‡ä»¶ä¸å­˜åœ¨
- `1`: æ–‡ä»¶ä¸Šä¼ å·²å®Œæˆ
- `2`: æ–‡ä»¶ä¸Šä¼ è¿›è¡Œä¸­

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `PORT` | `7777` | æœåŠ¡å™¨ç«¯å£ |

### æ–‡ä»¶å­˜å‚¨

- **ä¸Šä¼ ç›®å½•**: `./uploads/` - æœ€ç»ˆåˆå¹¶çš„æ–‡ä»¶
- **ä¸´æ—¶ç›®å½•**: `./temp/` - ä¸Šä¼ è¿‡ç¨‹ä¸­çš„ä¸´æ—¶åˆ†å—

### è¯·æ±‚é™åˆ¶

- **åˆ†å—å¤§å°**: æ¯ä¸ªåˆ†å—æœ€å¤§ 50MB
- **è¯·æ±‚è¶…æ—¶**: 5 åˆ†é’Ÿ

## ğŸ—ï¸ æ–‡ä»¶ä¸Šä¼ æµç¨‹

1. **å®¢æˆ·ç«¯åˆ†å‰²æ–‡ä»¶** ä¸ºå¤šä¸ªåˆ†å—å¹¶è®¡ç®—MD5
2. **ä¸Šä¼ åˆ†å—** å¯ä»¥é¡ºåºæˆ–å¹¶è¡Œä¸Šä¼ 
3. **æœåŠ¡å™¨å­˜å‚¨** æ¯ä¸ªåˆ†å—åˆ°ä¸´æ—¶ç›®å½•
4. **è¿›åº¦è·Ÿè¸ª** é€šè¿‡çŠ¶æ€APIå®æ—¶æŸ¥è¯¢
5. **è‡ªåŠ¨åˆå¹¶** å½“æ‰€æœ‰åˆ†å—æ¥æ”¶å®Œæˆæ—¶
6. **MD5æ ¡éªŒ** éªŒè¯åˆå¹¶åæ–‡ä»¶çš„å®Œæ•´æ€§
7. **æ¸…ç†ä¸´æ—¶æ–‡ä»¶** åˆ é™¤ä¸´æ—¶åˆ†å—æ–‡ä»¶

## ğŸ“ ç›®å½•ç»“æ„

```
fileUploadServer/
â”œâ”€â”€ src/                 # æºä»£ç 
â”œâ”€â”€ dist/                # ç¼–è¯‘åçš„JavaScriptæ–‡ä»¶
â”œâ”€â”€ uploads/             # æœ€ç»ˆä¸Šä¼ çš„æ–‡ä»¶
â”œâ”€â”€ temp/                # ä¸´æ—¶ä¸Šä¼ åˆ†å—
â”œâ”€â”€ package.json         # ä¾èµ–å’Œè„šæœ¬é…ç½®
â”œâ”€â”€ tsconfig.json        # TypeScripté…ç½®
â”œâ”€â”€ .gitignore          # Gitå¿½ç•¥è§„åˆ™
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### ä½¿ç”¨ cURL æµ‹è¯•ä¸Šä¼ 

```bash
# ä¸Šä¼ å•ä¸ªåˆ†å—
curl -X POST http://localhost:7777/BigFileUploader \
  -F "file=@test.txt" \
  -F "name=test.txt" \
  -F "chunks=1" \
  -F "chunk=1" \
  -F "totalLength=1024" \
  -F "totalFileMd5=abc123..." \
  -F "user_uid=user123"
```

### ä½¿ç”¨ cURL æµ‹è¯•ä¸‹è½½

```bash
# ä¸‹è½½å®Œæ•´æ–‡ä»¶
curl "http://localhost:7777/BigFileDownloader?file_md5=abc123...&user_uid=user123" \
  -o downloaded_file.txt

# ä»ç¬¬1024å­—èŠ‚å¼€å§‹æ–­ç‚¹ç»­ä¼ 
curl "http://localhost:7777/BigFileDownloader?file_md5=abc123...&user_uid=user123&skip_length=1024" \
  -o downloaded_file.txt
```

### ä½¿ç”¨ cURL æµ‹è¯•çŠ¶æ€æŸ¥è¯¢

```bash
curl -X POST http://localhost:7777/api/file/status \
  -H "Content-Type: application/json" \
  -d '{
    "processorId": "PROCESSOR_FILE",
    "jobDispatchId": "LOGIC_FILE_MGR",
    "actionId": "ACTION_APPEND1",
    "newData": {
      "file_md5": "abc123...",
      "user_uid": "user123",
      "file_type": 0
    }
  }'
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ä¸Šä¼ è¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤åˆ†å—å¤§å°ä¸è¶…è¿‡50MB
   - æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

2. **MD5æ ¡éªŒå¤±è´¥**
   - ç¡®è®¤å®¢æˆ·ç«¯è®¡ç®—çš„MD5æ­£ç¡®
   - æ£€æŸ¥æ–‡ä»¶ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰æŸå
   - é‡æ–°ä¸Šä¼ æ–‡ä»¶

3. **æ–‡ä»¶åˆå¹¶å¤±è´¥**
   - ç¡®è®¤æ‰€æœ‰åˆ†å—éƒ½å·²ä¸Šä¼ 
   - æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
   - æŸ¥çœ‹æœåŠ¡å™¨é”™è¯¯æ—¥å¿—

### æ—¥å¿—æŸ¥çœ‹

æœåŠ¡å™¨ä¼šè¾“å‡ºè¯¦ç»†çš„æ“ä½œæ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- æ–‡ä»¶ä¸Šä¼ å¼€å§‹å’Œç»“æŸ
- åˆ†å—ä¿å­˜çŠ¶æ€
- æ–‡ä»¶åˆå¹¶è¿‡ç¨‹
- MD5æ ¡éªŒç»“æœ
- é”™è¯¯ä¿¡æ¯

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å»ºè®®é…ç½®

1. **å¹¶å‘ä¸Šä¼ **: å®¢æˆ·ç«¯å¯ä»¥å¹¶è¡Œä¸Šä¼ å¤šä¸ªåˆ†å—
2. **åˆ†å—å¤§å°**: å»ºè®®10-50MBï¼Œæ ¹æ®ç½‘ç»œæ¡ä»¶è°ƒæ•´
3. **å†…å­˜ç®¡ç†**: æœåŠ¡å™¨ä¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ä½¿ç”¨
4. **ç£ç›˜ç©ºé—´**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ä¸´æ—¶å­˜å‚¨ç©ºé—´

### ç›‘æ§æŒ‡æ ‡

- ä¸Šä¼ é€Ÿåº¦
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜I/O
- ç½‘ç»œå¸¦å®½
- é”™è¯¯ç‡

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

### å¼€å‘è§„èŒƒ

- ä½¿ç”¨ TypeScript è¿›è¡Œç±»å‹å®‰å…¨å¼€å‘
- éµå¾ª ESLint ä»£ç è§„èŒƒ
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ”— ç›¸å…³é¡¹ç›®

- [Express.js](https://expressjs.com/) - Web æ¡†æ¶
- [Multer](https://github.com/expressjs/multer) - æ–‡ä»¶ä¸Šä¼ ä¸­é—´ä»¶
- [TypeScript](https://www.typescriptlang.org/) - ç±»å‹å®‰å…¨çš„ JavaScript
- [fs-extra](https://github.com/jprichardson/node-fs-extra) - å¢å¼ºçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [API æ¥å£æ–‡æ¡£](#-api-æ¥å£æ–‡æ¡£)
2. é˜…è¯» [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
3. æŸ¥çœ‹ [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)
4. åœ¨ GitHub ä¸Šåˆ›å»º Issue

## ğŸ¯ æœªæ¥è§„åˆ’

- [ ] æ”¯æŒæ›´å¤šæ–‡ä»¶ç±»å‹
- [ ] æ·»åŠ æ–‡ä»¶å‹ç¼©åŠŸèƒ½
- [ ] å®ç°ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- [ ] æ·»åŠ æ–‡ä»¶é¢„è§ˆåŠŸèƒ½
- [ ] æ”¯æŒäº‘å­˜å‚¨é›†æˆ
- [ ] æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡

---

**ä½¿ç”¨ â¤ï¸ å’Œ TypeScriptã€Node.js æ„å»º**